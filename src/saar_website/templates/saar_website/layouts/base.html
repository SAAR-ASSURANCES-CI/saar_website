{% load static %}
<!DOCTYPE html>
<html lang="fr">

    <head>
        <meta charset="utf-8">
        <title>
            
          {% block title %}SAAR Assurances C√¥te d'Ivoire - Assurance non-vie et vie en C√¥te d'Ivoire{% endblock %}
                 
        </title>
        <meta content="width=device-width, initial-scale=1.0" name="viewport">
         <!-- Mots-cl√©s -->
        <meta content="{% block keywords %}SAAR, saar, SAAR Assurances, saar assurance, saar assurances, SAAR CI, SAAR VIE, SAAR VIE CI, SAAR Assurances C√¥te d'Ivoire, SAAR Assurances CI, assurance, assurance auto, assurance sant√©, assurance habitation, assurance entreprise, assurance C√¥te d'Ivoire, assurance Abidjan, SAAR Vie C√¥te d'Ivoire, Top 10 march√© Ivoirien{% endblock %}" name="keywords">
        <!-- Description pour Google -->
        <meta name="description" content="{% block description %}SAAR Assurances C√¥te d'Ivoire, votre partenaire de confiance pour tous vos besoins d'assurance en C√¥te d'Ivoire.{% endblock %}">

        <!-- Auteur et copyright -->
        <meta name="author" content="SAAR Assurances C√¥te d'Ivoire">
        <meta name="robots" content="index, follow">
        <meta name="language" content="French">

        <!-- Open Graph pour Facebook/LinkedIn -->
        <meta property="og:site_name" content="SAAR Assurances C√¥te d'Ivoire">
        <meta property="og:title" content="{% block og_title %}SAAR Assurances C√¥te d'Ivoire - Protection compl√®te en C√¥te d'Ivoire{% endblock %}">
        <meta property="og:description" content="{% block og_description %}D√©couvrez nos solutions d'assurance adapt√©es √† vos besoins.{% endblock %}">
        <meta property="og:image" content="{% block og_image %}https://saarassurancesci.com{% static 'img/saar_logo_new.jpg' %}{% endblock %}">
        <meta property="og:url" content="https://saarassurancesci.com">
        <meta property="og:type" content="website">
        <meta property="og:locale" content="fr_CI">


        <!-- Twitter Card -->
        <meta name="twitter:card" content="summary_large_image">
        <meta name="twitter:site" content="@saarassurances">
        <meta name="twitter:title" content="{% block twitter_title %}SAAR Assurances{% endblock %}">
        <meta name="twitter:description" content="{% block twitter_description %}Votre partenaire assurance en C√¥te d'Ivoire{% endblock %}">
        <meta name="twitter:image" content="{% block twitter_image %}https://saarassurancesci.com{% static 'img/saar_logo_new.jpg' %}{% endblock %}">

         <!-- Favicons -->
        <link href="{% static 'img/saar_logo_new.jpg' %}" rel="icon">

        <!-- Google Web Fonts -->
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Jost:wght@500;600&family=Roboto&display=swap" rel="stylesheet"> 

        <!-- Icon Font Stylesheet -->
        {% comment %} <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.4/css/all.css"/> {% endcomment %}
        {% comment %} <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/> {% endcomment %}

        <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css" rel="stylesheet">

        <!-- Version 5.15.4 (plus stable) -->
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"/>
       
        
        <!-- Libraries Stylesheet -->
        <link href="{% static 'lib/owlcarousel/assets/owl.carousel.min.css' %}" rel="stylesheet">
        <link href="{% static 'lib/lightbox/css/lightbox.min.css' %}" rel="stylesheet">


        <!-- Customized Bootstrap Stylesheet -->
        <link href="{% static 'css/bootstrap.min.css' %}" rel="stylesheet">

        <!-- Template Stylesheet -->
        <link href="{% static 'css/style.css' %}" rel="stylesheet">
        <link href="{% static 'css/style_produit.css' %}" rel="stylesheet">

        <!-- Donn√©es structur√©es JSON-LD pour Google -->
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "InsuranceAgency",
        "name": "SAAR Assurances",
        "image": "https://saarassurancesci.com{% static 'img/saar_logo_new.jpg' %}",
        "url": "https://saarassurancesci.com",
        "telephone": "+225-27-22-50-81-50",
        "priceRange": "$$",
        "address": {
          "@type": "PostalAddress",
          "streetAddress": "Votre adresse compl√®te",
          "addressLocality": "Abidjan",
          "addressRegion": "Abidjan",
          "postalCode": "00225",
          "addressCountry": "CI"
        },
        "geo": {
          "@type": "GeoCoordinates",
          "latitude": 5.3845879,
          "longitude": -3.9942638
        },
        "openingHoursSpecification": [
          {
            "@type": "OpeningHoursSpecification",
            "dayOfWeek": ["Lundi", "Mardi", "Mercredi", "Jeudi", "Vendredi"],
            "opens": "08:00",
            "closes": "18:00"
          }
        ],
        "sameAs": [
          "https://www.facebook.com/saarassurances.ci",
          "https://www.linkedin.com/company/saar-assurances-c%C3%B4te-d-ivoire/posts/?feedView=all",
        ]
      }
      </script>


        {% block extra_head %}
        {% endblock extra_head %}

        
    </head>

    <body>

        <!-- Spinner Start -->
         <div id="spinner" class="show bg-white position-fixed translate-middle w-100 vh-100 top-50 start-50 d-flex align-items-center justify-content-center">
            <div class="spinner-border text-primary" style="width: 3rem; height: 3rem;" role="status">
                <span class="sr-only">Loading...</span>
            </div>
        </div> 
        <!-- Spinner End -->


        {% include 'saar_website/partials/header.html' %}


          
          {% block content %}
            <h2>My web site</h2>
          {% endblock content %}


          <section class="back-to">
            <div class="container py-5">
              <div class="row d-flex justify-content-center">

                
                <div >   
                    
                    <!-- Button trigger for the collapsible chat -->

                 <a id="chatToggle" class="btn btn-lg btn-block btn-md-square back-to" role="button">
                      <i class="fas fa-comment-dots fa-beat" style="color: white; --fa-beat-scale: 1.5;"></i>  
                      <span class="tooltip-text">Posez-moi une question</span>  
                  </a>
              
                  <!-- Collapsed content (initially hidden) -->
                  <div id="chatSection" class="mt-3" style="display: none; margin-right: 20px;">
                    
                    <div class="card" style="position: relative;" id="chat4">
                      <!-- Ent√™te du Chat -->
                      <!-- Ent√™te du Chat avec espace entre l'ic√¥ne et le texte -->
                        <div class="card-header d-flex justify-content-start align-items-center">
                          <i class="fas fa-comment-dots" style="font-size: 150%; margin-right: 4px;"></i>  
                          <h4 class="ms-2 my-0">SAARCI Assistant</h4>

                          <button id="closeChat" style="position: absolute; top: 10px; right: 10px; background: none; border: none; font-size: 200%%; cursor: pointer;">
                            &times; <!-- Ic√¥ne de fermeture -->
                          </button>
                        </div>
                      <div class="card-body" id="chat-body" style="position: relative; overflow-y: auto;">
                        <!-- Chat content -->
                        <div class="d-flex flex-row justify-content-start mb-4">
                         
                            <i class="fas fa-user-tie" style="font-size: 45px; color: #D6B033;" ></i>
                          <div>
                            <p class="small p-2 ms-3 mb-1 text-white rounded-3 bg-primary">Salut ! <br> Bienvenue √† SAAR Assurances C√¥te d'Ivoire.</p>
                            <p class="small p-2 ms-3 mb-1 text-white rounded-3 bg-primary">Comment puis je vous aider ?</p>
                          </div>
                        </div>
          
                        <div class="divider d-flex align-items-center mb-4">
                        </div>
          
                        <!-- Other chat messages here... -->
          
                      </div>

                      <div id='test-cont' class="card-footer text-muted d-flex justify-content-start align-items-center p-3">
                     
                          <i class="fas fa-user" style="font-size: 45px; color: #B4B4B8; margin-right: 5px;" ></i>

                       
                          <textarea class="form-control" id="exampleFormControlInput3" rows="2" placeholder="Posez moi votre question... "></textarea>
                        <a class="ms-3 link-info" style="z-index: 9999; color: var(--bs-primary);"><i class="fas fa-paper-plane" style="font-size: 180%;"></i></a>
                        
                      </div>
                    </div>
                  </div>
          
                </div>
              </div>
            </div>
          </section>
        
          
       


        {% include 'saar_website/partials/footer.html' %}
            

        <!-- Chatbot Affiche -->

          <!-- Buttons trigger collapse -->
          <!-- Back to Top -->
        {% comment %} <div class="d-flex justify-content-end mb-4"> {% endcomment %}
         
        {% comment %} </div> {% endcomment %}
            
        <!-- Back to Top -->
        <div class="d-flex justify-content-start">
            <a href="#" class="btn btn-primary btn-primary-outline-0 btn-md-square back-to-top"><i class="fa fa-arrow-up"></i></a>   
        </div>

      

        <a id='back-to-at' href="{% url 'contact' %}" class="btn btn-primary btn-lg btn-block btn-md-square back-to-at" role="button" >
          <i class="fas fa-phone fa-shake" style="color: white;"></i>  
          <span class="tooltip-text">Besoin d'aide ! Contactez-nous.</span>  
        </a>

        <script>
            document.getElementById("chatToggle").addEventListener("click", function() {
              var chatSection = document.getElementById("chatSection");

              var back_to_at = document.getElementById("back-to-at");
              var icon = this.querySelector('i');
          
              if (chatSection.style.display === "none" || chatSection.style.display === "") {
                chatSection.style.display = "block";
                back_to_at.style.display = "none";

               /* icon.classList.remove("fa-chevron-down");
                icon.classList.add("fa-chevron-up");*/
              } else {
                chatSection.style.display = "none";
                back_to_at.style.display = "flex";
               /* icon.classList.remove("fa-chevron-up");
                icon.classList.add("fa-chevron-down");*/
              }
            });

            document.getElementById("closeChat").addEventListener("click", function() {
              var chatSection = document.getElementById("chatSection");
              var back_to_at = document.getElementById("back-to-at");
              chatSection.style.display = "none";
              back_to_at.style.display = "flex";
              var icon = document.getElementById("chatToggle").querySelector('i');
              /*icon.classList.remove("fa-chevron-up");
              icon.classList.add("fa-chevron-down");*/
          });

          


          {% comment %} fonction qui envoi le message √† l'API Flask {% endcomment %}
            {% comment %} document.querySelector('.fa-paper-plane').addEventListener('click', function() {

              // Afficher la r√©ponse de l'API dans l'interface de chat
              var chatBody = document.querySelector('#chat-body');

              var userMessage = document.querySelector('#exampleFormControlInput3').value;


              var userMessageElement = `<div class="d-flex flex-row justify-content-end mb-4 pt-1">
                <div>
                    <p class="small p-2 me-3 mb-1 rounded-3 bg-light" style="color: black;">${userMessage}</p>
                </div>
                <i class="fas fa-user" style="font-size: 45px; color: #B4B4B8;"></i>
                </div>`;
                chatBody.innerHTML += userMessageElement;

              
                 // Faire d√©filer le chat vers le bas pour voir le dernier message
                 chatBody.scrollTop = chatBody.scrollHeight;

                // Ins√©rer le spinner apr√®s le message de l'utilisateur
                var spinnerElement = `<div class="spinner-grow bg-primary" id="loading-spinner" style="display: none; text-align: center;" role="status">
                          <span class="sr-only">Loading...</span>
                        </div>`;

                chatBody.innerHTML += spinnerElement;

                // Faire d√©filer le chat vers le bas pour voir le dernier message
                chatBody.scrollTop = chatBody.scrollHeight;


              // Afficher l'animation de chargement
                var loadingSpinner = document.querySelector('#loading-spinner');
                loadingSpinner.style.display = 'block';

                // R√©cup√©rer le message de l'utilisateur
              //  var userMessage = document.querySelector('#exampleFormControlInput3').value;
          
                // Cr√©er une requ√™te POST √† l'API Flask
                fetch('http://127.0.0.1:5000/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ query: userMessage }),

                })
                .then(response => response.json())
                .then(data => {

                  // Retirer le spinner une fois la r√©ponse re√ßue
                  var spinner = document.querySelector('#loading-spinner');
                  spinner.remove();

                  // Masquer l'animation de chargement
                  loadingSpinner.style.display = 'none';

                  

                    // Afficher la r√©ponse de l'API dans l'interface de chat
                   // var chatBody = document.querySelector('#chat-body');
          
                    // Ajouter le message de l'utilisateur
                  /*  var userMessageElement = `<div class="d-flex flex-row justify-content-end mb-4 pt-1">
                                                  <div>
                                                    <p class="small p-2 me-3 mb-1 rounded-3 bg-light" style="color: black;">${userMessage}</p>
                                              </div>
                                              <i class="fas fa-user" style="font-size: 45px; color: #B4B4B8;" ></i>`;
                    chatBody.innerHTML += userMessageElement;*/
          
                    // Ajouter la r√©ponse du bot
                    var botMessageElement = `<div class="d-flex flex-row justify-content-start mb-4">
                                                <i class="fas fa-user-tie" style="font-size: 45px; color: #D6B033;" ></i>
                                                 <div>
                                                    <p class="small p-2 ms-3 mb-1 text-white rounded-3 bg-primary">${data.response}</p>
                                                 </div>
                                             </div>`;
                    chatBody.innerHTML += botMessageElement;
          
                    // Effacer le champ de saisie
                    document.querySelector('#exampleFormControlInput3').value = '';
          
                    // Faire d√©filer le chat vers le bas pour voir le dernier message
                    chatBody.scrollTop = chatBody.scrollHeight;
                })
                .catch(error => {
                  // Masquer l'animation de chargement en cas d'erreur
                  loadingSpinner.style.display = 'none';
                  console.error('Error:', error);
              });
            }); {% endcomment %}

            // Historique de conversation (√† placer en d√©but de script)
            let conversationHistory = [];

            document.querySelector('.fa-paper-plane').addEventListener('click', function() {
                sendMessage();
            });

            // NOUVEAUX
            // Permettre l'envoi avec Entr√©e (Ctrl+Enter pour nouvelle ligne)
          document.querySelector('#exampleFormControlInput3').addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
          });


          //NOUVEAUX FONCTION SENDMESSAGE
          function sendMessage() {
            var chatBody = document.querySelector('#chat-body');
            var userMessage = document.querySelector('#exampleFormControlInput3').value.trim();
            
            // V√©rifier que le message n'est pas vide
            if (!userMessage) {
                return;
            }
            
            // Afficher le message de l'utilisateur
            var userMessageElement = `<div class="d-flex flex-row justify-content-end mb-4 pt-1">
                <div>
                    <p class="small p-2 me-3 mb-1 rounded-3 bg-light" style="color: black;">${escapeHtml(userMessage)}</p>
                </div>
                <i class="fas fa-user" style="font-size: 45px; color: #B4B4B8;"></i>
            </div>`;
            chatBody.innerHTML += userMessageElement;
            
            // Ajouter √† l'historique
            conversationHistory.push({
                role: 'user',
                content: userMessage
            });
            
            // Faire d√©filer le chat vers le bas
            chatBody.scrollTop = chatBody.scrollHeight;
            
            // Effacer le champ de saisie imm√©diatement
            document.querySelector('#exampleFormControlInput3').value = '';
            
            // Ins√©rer le spinner
            var spinnerElement = `<div class="d-flex flex-row justify-content-start mb-4" id="loading-spinner">
                <i class="fas fa-user-tie" style="font-size: 45px; color: #D6B033;"></i>
                <div>
                    <p class="small p-2 ms-3 mb-1 text-white rounded-3 bg-primary">
                        <span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
                        En train de r√©fl√©chir...
                    </p>
                </div>
            </div>`;
            chatBody.innerHTML += spinnerElement;
            
            // Faire d√©filer le chat vers le bas
            chatBody.scrollTop = chatBody.scrollHeight;
            
            // Cr√©er une requ√™te POST √† l'API Flask avec l'historique
            fetch('http://127.0.0.1:5000/chat', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ 
                    query: userMessage,
                    history: conversationHistory  // Envoyer l'historique complet
                }),
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Erreur r√©seau');
                }
                return response.json();
            })
            .then(data => {
                // Retirer le spinner
                var spinner = document.querySelector('#loading-spinner');
                if (spinner) {
                    spinner.remove();
                }
                
                // Ajouter la r√©ponse du bot
                var botMessageElement = `<div class="d-flex flex-row justify-content-start mb-4">
                    <i class="fas fa-user-tie" style="font-size: 45px; color: #D6B033;"></i>
                    <div>
                        <p class="small p-2 ms-3 mb-1 text-white rounded-3 bg-primary">${escapeHtml(data.response)}</p>
                    </div>
                </div>`;
                chatBody.innerHTML += botMessageElement;
                
                // Ajouter la r√©ponse √† l'historique
                conversationHistory.push({
                    role: 'assistant',
                    content: data.response
                });
                
                // Limiter l'historique aux 10 derniers messages (5 √©changes)
                if (conversationHistory.length > 10) {
                    conversationHistory = conversationHistory.slice(-10);
                }
                
                // Faire d√©filer le chat vers le bas
                chatBody.scrollTop = chatBody.scrollHeight;
                
                console.log('üìú Historique actuel:', conversationHistory.length, 'messages');
            })
            .catch(error => {
                // Retirer le spinner en cas d'erreur
                var spinner = document.querySelector('#loading-spinner');
                if (spinner) {
                    spinner.remove();
                }
                
                // Afficher un message d'erreur
                var errorMessageElement = `<div class="d-flex flex-row justify-content-start mb-4">
                    <i class="fas fa-user-tie" style="font-size: 45px; color: #dc3545;"></i>
                    <div>
                        <p class="small p-2 ms-3 mb-1 text-white rounded-3" style="background-color: #dc3545;">
                            ‚ùå D√©sol√©, une erreur s'est produite. Veuillez r√©essayer.
                        </p>
                    </div>
                </div>`;
                chatBody.innerHTML += errorMessageElement;
                
                // Faire d√©filer le chat vers le bas
                chatBody.scrollTop = chatBody.scrollHeight;
                
                console.error('Error:', error);
            });
            }
            //NOUVEAUX FONCTION SENDMESSAGE FIN

            // Fonction pour √©chapper le HTML (s√©curit√© XSS)
            function escapeHtml(text) {
              var map = {
                  '&': '&amp;',
                  '<': '&lt;',
                  '>': '&gt;',
                  '"': '&quot;',
                  "'": '&#039;'
              };
              return text.replace(/[&<>"']/g, function(m) { return map[m]; });
            }
            // Fonction pour √©chapper le HTML (s√©curit√© XSS) FIN




            // Fonction pour afficher la r√©ponse mot par mot
  function displayResponseWordByWord(text, element) {
      const words = text.split(' ');
      let index = 0;

      function displayNextWord() {
          if (index < words.length) {
              element.innerHTML += words[index] + ' ';
              index++;
              setTimeout(displayNextWord, 100); // D√©lai de 100 ms entre chaque mot
          }
      }

    displayNextWord();
  }


     document.querySelectorAll('.dropdown-submenu > a').forEach(function(el){
      el.addEventListener('click', function(e){
        e.preventDefault();
        e.stopPropagation();

        // Fermer tous les autres sous-menus
        document.querySelectorAll('.dropdown-submenu .dropdown-menu').forEach(function(menu){
          menu.style.display = "none";
        });

        // Ouvrir celui cliqu√©
        let submenu = this.nextElementSibling;
        if(submenu && submenu.style.display !== "block"){
          submenu.style.display = "block";
        }
      });
    });

    document.addEventListener("DOMContentLoaded", function() {
  document.querySelectorAll('.dropdown-submenu .dropdown-menu').forEach(function(menu) {
    menu.style.display = "none"; // ferme tous les sous-menus
  });
});

document.addEventListener("DOMContentLoaded", function() {
  // cibler tous les sous-menus
  document.querySelectorAll(".dropdown-submenu").forEach(function(item) {
    let link = item.querySelector(".dropdown-toggle");
    let submenu = item.querySelector(".dropdown-menu");

    // quand on survole le lien
    link.addEventListener("mouseenter", function() {
      // r√©cup√©rer la position du lien
      let linkRect = link.getBoundingClientRect();

      // ajuster la position verticale du sous-menu
      submenu.style.top = link.offsetTop + "px";
    });
  });
});


          
      </script>

          <!-- JavaScript Libraries -->
          <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
          <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"></script>
          <script src="{% static 'lib/easing/easing.min.js' %}"></script>
          <script src="{% static 'lib/waypoints/waypoints.min.js' %}"></script>
          <script src="{% static 'lib/owlcarousel/owl.carousel.min.js' %}"></script>
          <script src="{% static 'lib/lightbox/js/lightbox.min.js' %}"></script>
          
  
          <!-- Template Javascript -->
          <script src="{% static 'js/main.js' %}"></script>
          <script src="{% static 'js/main_produit.js' %}"></script>

      </body>
  
  </html>